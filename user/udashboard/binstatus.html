<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Landing Page</title>
    <!--Links-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <style>
        body {
            background-color: #cadfaf;
            /* Light green background */
            font-family: 'Arial', sans-serif;
            position: relative;

        }

        header {
            border-bottom: 1px solid #006400 !important;
            /* Dark green border */
            position: relative;
            z-index: 10;
        }
        .app-wrapper {
            width: 100%;
            /* Full width */
            max-width: 1200px;
            /* Max width for larger screens */
            padding: 20px;
            /* Padding around the container */
            background: rgba(255, 255, 255, 0.7);
            /* White background with transparency */
            backdrop-filter: blur(15px);
            /* More blur for glassmorphism effect */
            border-radius: 20px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
            /* Slightly darker shadow for depth */
            margin: 20px auto;
            /* Center the wrapper with margin */
            height: 800px;
            /* Adjusted height for the container */
            overflow: hidden;
            /* Hide any overflow */
            position: relative;
            /* Added position relative */
            z-index: 1;
            /* Set z-index lower than the background image */
        }

        .title-section {
            text-align: left;
            margin-top: 50px;
            margin-left: 20px;
            position: relative;
            z-index: 10;
        }

        .title-section h1 {
            font-size: 64px;
            color: #006400;
            /* Dark green color */
            font-weight: bold;
        }

        .title-section p {
            font-size: 18px;
            margin-top: 20px;
        }

        .get-started-btn {
            margin-top: 300px;
            border-radius: 90px;
        }

        .image-background {
            position: fixed;
            bottom: 0;
            right: 0;
            z-index: 0;
            height: 100%;
            width: auto;
            opacity: 0.9;
        }

        @keyframes floatImage {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0);
            }
        }

        /* Center the navigation list */
        nav ul {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
        }

        nav ul li {
            list-style: none;
        }

        /* Add hover effect for the list items */
        nav ul li a {
            position: relative;
            color: #444;
            font-size: 18px;
            padding: 8px 16px;
            transition: color 0.3s;
            text-decoration: none;
        }

        nav ul li a:hover {
            color: #006400;
        }

        nav ul li a::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 3px;
            bottom: -5px;
            left: 0;
            background-color: #006400;
            visibility: hidden;
            transform: scaleX(0);
            transition: all 0.3s ease-in-out;
        }

        nav ul li a:hover::before {
            visibility: visible;
            transform: scaleX(1);
        }

        .btn-success {
            box-shadow: 0px 8px 15px rgba(0, 100, 0, 0.2);
        }

        .btn-success:hover {
            background-color: #004d00;
            box-shadow: 0px 15px 20px rgba(0, 100, 0, 0.4);
            transform: translateY(-3px);
        }

        .get-started-btn {
            margin-top: 50px;
            padding: 15px 40px;
            border-radius: 50px;
            background-color: #006400;
            color: white;
            font-weight: bold;
            font-size: 20px;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0px 8px 15px rgba(0, 100, 0, 0.2);
            cursor: pointer;
            animation: bounce 2s infinite;
        }

        .get-started-btn:hover {
            background-color: #004d00;
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0px 15px 20px rgba(0, 100, 0, 0.4);
        }

        .get-started-btn:active {
            transform: scale(0.95);
            box-shadow: 0px 5px 10px rgba(0, 100, 0, 0.3);
        }

        /* Bounce animation keyframes */
        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }
        }

        .nav-link.active:hover {
            background-color: #28a745;
            /* Keep the same background color as active state */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            /* Add a subtle shadow on hover */
        }

        .nav-link {
            color: #333;
            /* Default link color */
            padding: 6px 15px;
            /* Add some padding */
            border-radius: 5px;
            /* Rounded corners for the links */
            transition: background-color 0.3s;
            /* Smooth background color change */
        }

        .nav-link:hover {
            background-color: #28a745;
            /* Green background on hover */
            color: white;
            /* Change text color on hover */
        }

        .nav-link.active {
            background-color: #28a745;
            /* Active tab color */
            color: white;
            /* Active tab text color */
        }

        .nav-link.active:hover {
            background-color: #28a745;
            /* Keep the same background color as active state */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            /* Add a subtle shadow on hover */
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.0.0"></script>
</head>

<body>
    <img src="Trash.png" alt="Solid Waste Management Image" class="image-background">
    <div class="container">
        <header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4">
            <div class="col-md-3 mb-2 mb-md-0"></div>
            <nav class="col-12 col-md-auto mb-2 justify-content-center mb-md-0 mt-3">
                <ul>
                    <li><a href="/nanaman/user/udashboard/userdashboard.html" class="nav-link">Home</a></li>
                    <li><a href="MapLanding.html" class="nav-link">Maps</a></li>
                    <li><a href="profile.html" class="nav-link">Profile</a></li>
                    <li><a href="#" class="nav-link active">Bin Status</a></li>
                    <li><a href="report.html" class="nav-link">Report</a></li>
                    <li><a href="/nanaman/user/index.html" class="nav-link">Log out</a></li>
                </ul>
            </nav>
        </header>
    </div>
    <div class="app-wrapper card">
		<div class="app-content pt-3 p-md-3 p-lg-4">
			<div class="container-xl">
				<!-- Collection Point Name -->
				<div class="row g-3 mb-4 align-items-center justify-content-between">
					<div class="col-auto">
						<h1 class="app-page-title mb-0" id="collection-name">Collection Point</h1>
					</div>
				</div>
	
				<!-- Image and Status in Two Rows -->
				<div class="row" id="status-row">
					<div class="col-md-4">
						<!-- Dynamic Image from Supabase -->
						<div id="image-container" style="background-image: url('assets/images/default-placeholder.jpg'); height: 150px; background-size: cover; background-position: center; border-radius: 8px;">
						</div>
					</div>
					<div class="col-md-8">
						<!-- Status Data -->
						<div class="status-data" id="status-data" style="display:none;">
							<h3 id="garbage-status"></h3>
							<p id="status-description"></p>
							<p id="timestamp"></p>
						</div>
					</div>
				</div>
	
				<!-- Dropdown with Button -->
				<div class="mt-4">
					<div class="input-group">
						<select id="collectionPoint" class="form-select">
							<option value="CP1">Collection Point 1</option>
							<option value="CP2">Collection Point 2</option>
						</select>
						<button id="changeImageBtn" class="btn btn-primary">Check</button>
					</div>
				</div>
	
				<!-- Logs Notification -->
				<div class="logs-section mt-4 app-card app-card-orders-table shadow-sm mb-5" id="logs-section" style="display:none;">
					<div class="app-card-body">
						<div class="table-responsive">
							<table class="table app-table-hover mb-0 text-left">
								<thead>
									<tr>
										<th class="cell">Location</th>
										<th class="cell">Image Source</th>
										<th class="cell">Date and Time</th>
										<th class="cell">Status</th>
									</tr>
								</thead>
								<tbody id="logs-tbody">
									<!-- Log data will be injected here -->
								</tbody>
							</table>
						</div><!--//table-responsive-->
					</div><!--//app-card-body-->
				</div><!--//app-card-->
			</div>
		</div><!--//app-content-->
	</div><!--//app-wrapper-->
	<script>
		// Initialize Supabase client
		const { createClient } = supabase;
		const _supabase = createClient('https://uiciowpyxfawjvaddivu.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVpY2lvd3B5eGZhd2p2YWRkaXZ1Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcyNzE0MDQyMCwiZXhwIjoyMDQyNzE2NDIwfQ.kR8PsVyqtW0QTJoFjFq6aiXU-iq0y3alXfJQIRMVgBw');
	
		let subscription;
	
		// Function to subscribe to realtime updates based on selected CP
		function subscribeToUpdates(cpId) {
			// Unsubscribe from the previous channel if it exists
			if (subscription) {
				_supabase.removeChannel(subscription);
			}
	
			// Subscribe to new changes based on the selected collection point (CP)
			subscription = _supabase
				.channel('collection-point-updates')
				.on(
					'postgres_changes',
					{ event: '*', schema: 'public', table: 'images', filter: `cp_id=eq.${cpId}` },
					(payload) => {
						const updatedImageUrl = payload.new.image_url;
						console.log('New image received:', updatedImageUrl);
						updateImage(updatedImageUrl);
					}
				)
				.subscribe();
		}
	
		// Function to update image based on the latest data from Supabase
		function updateImage(imageUrl) {
			const imageContainer = document.getElementById('image-container');
			imageContainer.style.backgroundImage = `url('${imageUrl}')`;
		}
	
		// Function to handle uploading a request
		async function uploadRequest() {
			const collectionPointId = document.getElementById('collectionPoint').value;
			const { error } = await _supabase
				.from('controls')
				.insert([{ who: 'live request ' + collectionPointId }]);
	
			if (error) {
				console.error('Error inserting request:', error);
			} else {
				console.log('Request uploaded successfully');
			}
		}
	
		// Function to update status and logs (dummy data for demonstration)
		function updateStatusAndLogs(cpId) {
			const statusData = document.getElementById('status-data');
			const logsTbody = document.getElementById('logs-tbody');
			const garbageStatus = document.getElementById('garbage-status');
			const statusDescription = document.getElementById('status-description');
			const timestamp = document.getElementById('timestamp');
			const now = new Date();
			timestamp.innerHTML = "Date and Time: " + now.toLocaleString();
	
			// Clear the logs
			logsTbody.innerHTML = '';
	
			// Update status and logs based on the selected CP
			if (cpId === 'CP1') {
				garbageStatus.innerHTML = "Garbage Status: Full";
				garbageStatus.style.color = "red";
				statusDescription.innerHTML = "Needs to be emptied";
	
				// Add logs (dummy data)
				logsTbody.innerHTML += `<tr>
					<td>Location 1</td>
					<td><a href="#">VIEW</a></td>
					<td>12 Oct, 04:23 PM</td>
					<td><span class="badge bg-danger">Full</span></td>
				</tr>`;
			} else if (cpId === 'CP2') {
				garbageStatus.innerHTML = "Garbage Status: Available";
				garbageStatus.style.color = "green";
				statusDescription.innerHTML = "Available, you can throw your trash";
	
				// Add logs (dummy data)
				logsTbody.innerHTML += `<tr>
					<td>Location 2</td>
					<td><a href="#">VIEW</a></td>
					<td>12 Oct, 04:23 PM</td>
					<td><span class="badge bg-success">Emptied</span></td>
				</tr>`;
			}
	
			// Show status data and logs
			statusData.style.display = "block";
			document.getElementById('logs-section').style.display = "block";
			document.getElementById('user-reports-section').style.display = "block";
		}
	
		// Handle dropdown change and subscription to new CP
		document.getElementById('collectionPoint').addEventListener('change', function () {
			const selectedCP = this.value;
			subscribeToUpdates(selectedCP); // Subscribe based on new selected collection point
			updateStatusAndLogs(selectedCP); // Update status and logs
		});
	
		// Handle button click
		document.getElementById('changeImageBtn').addEventListener('click', uploadRequest);
	
		// Handle the first subscription on page load (for default CP1)
		subscribeToUpdates(document.getElementById('collectionPoint').value);
		updateStatusAndLogs(document.getElementById('collectionPoint').value);
	
	</script>
	
	

		<!-- Javascript -->
		<script src="assets/plugins/popper.min.js"></script>
		<script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>

		<!-- Page Specific JS -->
		<script src="assets/js/app.js"></script>
</body>

</html>